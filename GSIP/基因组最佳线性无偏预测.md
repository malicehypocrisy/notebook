# 一、单性状动物基因模型

构建线性模型：
$$
\mathbf{y=Xb+Wu+e}
$$
其中，$\mathbf{W}$为表型与个体的关联矩阵，则$Var(u)=G\sigma^2_u,Var(e)=R$
$$
\begin{pmatrix}
\mathrm{X}' \mathrm{R}^{-1} \mathrm{X} & \mathrm{X}' \mathrm{R}^{-1} \mathrm{W} \\
\mathrm{W}' \mathrm{R}^{-1} \mathrm{X} & \mathrm{W}' \mathrm{R}^{-1} \mathrm{W} + \mathrm{G}^{-1} \sigma_u^{-2}
\end{pmatrix}
\begin{pmatrix}
\widehat{\mathrm{b}} \\
\widehat{\mathrm{u}}
\end{pmatrix}
=
\begin{pmatrix}
\mathrm{X}' \mathrm{R}^{-1} \mathrm{y} \\
\mathrm{W}' \mathrm{R}^{-1} \mathrm{y}
\end{pmatrix}
$$
若 $\mathrm{R} = \mathrm{I} \sigma_e^2$，则方差组分可分解，方程转化为:
$$
\begin{pmatrix}
\mathrm{X}' \mathrm{X} & \mathrm{X}' \mathrm{W} \\
\mathrm{W}' \mathrm{X} & \mathrm{W}' \mathrm{W} + \mathrm{I} \lambda
\end{pmatrix}
\begin{pmatrix}
\widehat{\mathrm{b}} \\
\widehat{\mathrm{u}}
\end{pmatrix}
=
\begin{pmatrix}
\mathrm{X}' \mathrm{y} \\
\mathrm{W}' \mathrm{y}
\end{pmatrix}
$$
其中 $\lambda = \sigma_e^2 / \sigma_u^2$。

# 二、多性状动物基因模型

$$
\begin{pmatrix}
\mathrm{X}' \mathrm{R}^{-1} \mathrm{X} & \mathrm{X}' \mathrm{R}^{-1} \mathrm{W} \\
\mathrm{W}' \mathrm{R}^{-1} \mathrm{X} & \mathrm{W}' \mathrm{R}^{-1} \mathrm{W} + \mathrm{G}^{-1} \otimes\mathrm{G}^{-1}_{0}
\end{pmatrix}
\begin{pmatrix}
\widehat{\mathrm{b}} \\
\widehat{\mathrm{u}}
\end{pmatrix}
=
\begin{pmatrix}
\mathrm{X}' \mathrm{R}^{-1} \mathrm{y} \\
\mathrm{W}' \mathrm{R}^{-1} \mathrm{y}
\end{pmatrix}
$$

其中$\mathbf{G}_0$是性状间遗传协方差矩阵，通常表现为$\mathbf{R}=\mathbf{I}\otimes\mathbf{R_0}$，这里$\mathbf{R_0}$代表残差协方差矩阵

## &#9352;可靠性

$$
\text{Rel}_i = 1 - \frac{C^{\text{ii}}}{G_{\text{ii}} \sigma_u^2}
$$

其中，$C^{ii}$是混合方程方程第一形式(即显式包含$σ^2_u$)逆矩阵的$i,i$元素，可靠性会受到基因编码的影响

近期研究建议：**将基础群体作为额外个体纳入，可自动将所有可靠性置于同 一尺度**

## &#9353;奇异阵$\mathbf{G}$下GBLUP

### &#9312; **原始形式（直接扩展标准方程）**

$$
\begin{pmatrix}
\mathrm{X}' \mathrm{R}^{-1} \mathrm{X} & \mathrm{X}' \mathrm{R}^{-1} \mathrm{W} \\
G \sigma_u^2 \mathrm{W}' \mathrm{R}^{-1} \mathrm{X} & G \sigma_u^2 \mathrm{W}' \mathrm{R}^{-1} \mathrm{W} + \mathrm{I}
\end{pmatrix}
\begin{pmatrix}
\widehat{\mathrm{b}} \\
\widehat{\mathrm{u}}
\end{pmatrix}
=
\begin{pmatrix}
\mathrm{X}' \mathrm{R}^{-1} \mathrm{y} \\
G \sigma_u^2 \mathrm{W}' \mathrm{R}^{-1} \mathrm{y}
\end{pmatrix}
$$

* 在右下角子阵加$\mathbf{I}$，强制可逆，导致**估计结果略有偏差**

&#9313; **对称形式（引入辅助向量 $\alpha$）**
$$
\begin{pmatrix}
\mathrm{X}' \mathrm{R}^{-1} \mathrm{X} & \mathrm{X}' \mathrm{R}^{-1} \mathrm{W} G \sigma_u^2 \\
G \sigma_u^2 \mathrm{W}' \mathrm{R}^{-1} \mathrm{X} & G \sigma_u^2 \mathrm{W}' \mathrm{R}^{-1} \mathrm{W} G \sigma_u^2 + G \sigma_u^2
\end{pmatrix}
\begin{pmatrix}
\widehat{\mathrm{b}} \\
\widehat{\alpha}
\end{pmatrix}
=
\begin{pmatrix}
\mathrm{X}' \mathrm{R}^{-1} \mathrm{y} \\
G \sigma_u^2 \mathrm{W}' \mathrm{R}^{-1} \mathrm{y}
\end{pmatrix}
$$
其中，$\hat{u}=\mathbf{G}\sigma{_u^2}\hat{\alpha}$

## &#9354;从 GBLUP到标记效应估计

- **理论基础**：

  在严格一致条件下（相同基因型矩阵 `Z`、等位基因频率 `p, q`、方差假设等），**GBLUP**（基于基因组关系矩阵 `G`的BLUP方法）与**BLUP-SNP**（直接估计标记效应 `a`的方法）的估计结果**在数学上等价**。

$$
\text{Var}
\begin{pmatrix}
\mathrm{u} \\
\mathrm{a}
\end{pmatrix}
=
\begin{pmatrix}
\mathrm{Z D Z'} & \mathrm{Z D} \\
\mathrm{D Z'} & \mathrm{D}
\end{pmatrix}
\\
\text{其中，}\mathbf{u=Za},Var(a)=D=\frac{\mathbf{I}\sigma_u^2}{2\sum{p_iq_i}}
$$

假设多元正态下，$p(\mathbf{u|a})=N(\mathbf{Za},0)$
$$
\widehat{\mathrm{u}} \mid \widehat{\mathrm{a}} = E \left( \mathrm{u} \mid \mathrm{a} = \widehat{\mathrm{a}} \right) = \mathrm{Z}' \widehat{\mathrm{a}}
$$
**反向推断**（育种值 → 标记效应）是**多解性问题**：同一个育种值 **u**可能对应多组标记效应 。



### &#9312;矩阵$\mathbf{G}$经过调谐
