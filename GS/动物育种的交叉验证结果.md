# 一、基于方法R的交叉验证准确率

## **阶段1：完整数据建模（基准）**

&#9312;**全数据EBV计算**

* 用​**​全部数据​**​（无缺失）运行GBLUP/PBLUP，生成基准育种值（EBV），作为后续比较的参照。

## **阶段2：部分数据建模（验证集）**

&#9313;**设定截止日期**

* 选择时间节点切割数据，模拟实际育种中"已知历史数据，预测未来"的场景。

&#9314;**创建部分数据集**

* 将​**​截止日期后的观测值设为缺失​**​，保留历史数据作为训练集。

&#9315;**计算部分EBV**

* 分别用​**​GBLUP​**​（步骤4）和​**​PBLUP​**​（步骤7）基于部分数据重新计算EBV。

## 阶段3：统计量计算（评估指标）

&#9316;**计算偏差（b）**
$$
\text{GBLUP偏差: }  b_{w, p}^{\text{GBLUP}} = \dfrac{\hat{u}_p' \mathbf{K^{-1}} \hat{u}_w}{\hat{u}_p'\mathbf{ K^{-1}} \hat{u}_p} \\
  \text{ PBLUP偏差:}  b_{w, p}^{\text{PBLUP}} = \dfrac{\hat{u}_p' \mathbf{ K^{-1}} \hat{u}_w}{\hat{u}_w'\mathbf{ K^{-1}} \hat{u}_w}
$$

* 理想GBLUP的$b = 1$，PBLUP的$b$反映偏差程度。
* $\mathbf{K}$是亲缘关系矩阵（==可能源自系谱或基因组==）

&#9317;**计算准确度（$\rho$）**

$$
\text{GBLUP准确度: }
  \rho_{p,w}^{\text{GBLUP}} = \frac{\hat{u}_p' \mathbf{K^{-1}} \hat{u}_w}{\sqrt{(\hat{u}_w' \mathbf{K^{-1}} \hat{u}_w)(\hat{u}_p'\mathbf{K^{-1}} \hat{u}_p)}}
 \\
  \text{PBLUP准确度:  } 
  \rho_{p,w}^{\text{PBLUP}} = \frac{\hat{u}_p' \mathbf{K^{-1}}\hat{u}_w}{\sqrt{(\hat{u}_w' \mathbf{K^{-1}} \hat{u}_w)(\hat{u}_p'\mathbf{K^{-1}} \hat{u}_p)}}
$$

* $\rho$ 直接衡量两种方法对核心个体（待选候选）的预测精度。

&#9318; **附加统计量**
$$

\text{平均偏差:} \mu_{wp} = (\mathbf{1}' K^{-1} \hat{u}_w - \mathbf{1}' K^{-1} \hat{u}_p) / n
 
$$

* 反映群体层面的系统性偏差
  