# 一、一般基础知识

## &#9352;数量遗传学基础

|          | 亲子间          | 半同胞间         | 全同胞间                           |
| -------- | --------------- | ---------------- | ---------------------------------- |
| 协方差   | $0.5\sigma_A^2$ | $0.25\sigma_A^2$ | $0.5\sigma_A^2 + \sigma^2(EI, FS)$ |
| 相关系数 | $0.5h^2$        | $0.25h^2$        | $0.5h^2 + C^2$                     |

* 用亲属间协方差与相关系数估计遗传参数的一个重要前提，**亲属间不存在环境协方差组分**。

## 2.二次型的一些基本性质

&#9312;设有二次型$\mathbf{y'Ay}$ ，其中$\mathbf{y}$为一随机向量，并有

$$
E(y) = \mathbf{X}\beta, \quad \text{Var}(\mathbf{y}) = \mathbf{V}
$$
&#9313;**性质**

* $E(\mathbf{y'Ay}) = \text{tr}(\mathbf{AV}) + \mathbf{\beta'X'AX\beta}$

* 如果 $\mathbf{A}$阵为正定阵，则必有 $\mathbf{y'Ay} \geq 0$

* 当$\mathbf{y}$服从正态分布$(y \sim N(\mathbf{X}\beta, \mathbf{V})$时，

$$
\text{Var}(\mathbf{y'Ay}) = 2\text{tr}(\mathbf{AVAV}) + 4\mathbf{\beta'X'AVAX\beta}
$$

* $\mathbf{y}$服从正态分布且 $AV$为幂等矩阵，即$AVAV = AV$ ，则 $y'Ay$服从==卡方分布==。

* 对两个二次型$ y'Ay$ 和$ y'By$，如 $\mathbf{y}$服从正态分布，则

$$
\text{Cov}(\mathbf{y'Ay, y'By}) = 2\text{tr}(\mathbf{AVBV}) + 4\beta'\mathbf{X'AVBX\beta}\\
\text{当}\mathbf{AVB} = 0\text{时，这个协方差为零，即这两个二次型相互独立。}
$$

# 二、随机模型下的方差组分估计

## &#9352;均衡数据资料的方差分析

* 前提：**每头公牛的女儿数相等时，方差分析**

* 对于组内来说，变异是由随机误差引起的（$\sigma^2_e$）。

## &#9353;非均衡资料的方差分析

| 变异           | SS                                                           | df           | MS                           | $\hat{\sigma}^2$                                             |
| -------------- | ------------------------------------------------------------ | ------------ | ---------------------------- | ------------------------------------------------------------ |
| 组间<br />组内 | $\sum{y_{i.}}/n_i - y^2_{..}/N$<br />$\sum{y^2_{ij}}-\sum{y^2_{i.}/n_i}$ | a-1<br />N-a | $SS_S/df_s$<br />$SS_e/df_e$ | $\hat{\sigma}^2_s =[MS_s-MS_e]/n^*$<br />$\hat{\sigma}^2_e =MS_e $ |
| 总的           |                                                              | N-1          |                              | $\hat{\sigma}^2_y = \hat{\sigma}^2_s +\hat{\sigma}^2_e  $    |

* 其中，$n^*=(N-\sum{n^2_i}/N)(a-1)$

# 三、估计方差组分的方法



## &#9353;用约化平方和估计方差组分

### &#9312;约化平方和的概念

* 对于任一模型来说，如果将模型中的某些因子略去不予考虑，可以得到一个子模型，通过比较不同的子模型可以判断某一因子的相对重要性。
* ==约化==：从全模型到子模型的过程
* **约化模型**：子模型
* **约化平方和**：各子模型乃至全模型的模型平方和，用符号$R()$表示。
* $SST = SSR +SSE$

### &#9313;约化平方和

* 任意模型的约化平方和是观察值向量$\mathbf{y}$的二次型，此二次型的矩阵为$\mathbf{X(X^`X)^{-1}X^`}$，其中$\mathbf{X}$**为模型中包含的所有效应的总结构矩阵**。
* 不满秩时存在很多个$\mathbf{X^`X}$

$$
SSR=R(\beta)=SST-SSR=\hat{\beta}^`\mathbf{X}^`\mathbf{y}
$$

### &#9314;子模型的配合

* 当建立一个线性模型，但不能确定是否模型中所有因子都重要时，可以将模型中因子一个一个的消除，分别建立一系列的子模型。
* 各因子显著性检验：**当子模型中未包含的因子具有很大的效应时，则该子模型的约化平方和将显著小于全模型的约化平方和**

$$
R(\mu, \alpha) =R(\alpha)
$$

* 对于任意约化平方和$\mathbf{y^`W(W^`W)^{-1}W^`y}$,消去$\mathbf{W}$中的非独立列,约化平方和的值不变.

### &#9315;随机模型与混合模型的约化平方和

* 进行估计方差组分,选择子模型的要求:均包含所有的固定效应,但不同的子模型包含不同的特定的随机效应.

### &#9316;总平方和与约化平方和的数学期望

### &#9317;方差组分的估计

$$
\{E(\mathbf{y^`W_{i}(W_{i}^`W_{i})^{-1}W_{i}y}\}=\{\mathbf{y^`W_{i}(W_{i}^`W_{i})^{-1}W_{i}y}\}
$$

## &#9354;方差组分估计步骤及估计值

### &#9312;步骤

&#9332;定义必要的二次型.

&#9333;令二次型等于未知参数(方差组分与群体均数)的某个函数。

* 无偏而言，这些函数为二次型的向量。
* 有偏而言，这些函数为似然函数的对数。

&#9334;解方程求未知参数。

* 在无偏估计方法中，涉及对期望值系数矩阵求逆，然后用该矩阵乘以二次型的向量。
* 在有偏估计中，可能要反复多次执行步骤1与2才能求的估计值

### &#9313;性质

#### &#9332;平移不变性

* $\mathbf{AZ=0}是$$\mathbf{y^`Ay}$具有平移不变性的充要条件。

$$
E(\mathbf{y^`Ay})=tr(\mathbf{AV})
$$

#### &#9313;估计值的方差

$$
Var(\mathbf{y^`Ay})=2tr(\mathbf{AVAV})
\\
\text{Cov}(\mathbf{y'Ay, y'By}) = 2\text{tr}(\mathbf{AVBV}) 
\\
\text{其中，}\mathbf{V}=\sum{\mathbf{Z_i Z_i^`}\sigma^2_{i}+\mathbf{I}\sigma^2_{e}}
$$

# 三、HENDERSON方法

核心思想：**通过对平方和（或均方）求数学期望来求方差组分的无偏估计。**

## &#9352;方法一

### &#9312;适用范围：

* 仅适用于$\mathbf{X\beta=1\mu}$的随机模型，即：$\mathbf{y=1\mu+\sum{Z_i u_i}+e}$
* 估计值具有平移不变性和无偏性。
* 选用最简单的约化平方和（仅含一个因子）。

### &#9313;基本方法：

#### &#9332;定义二次型

* $$
  \mathbf{A_1}=\mathbf{I},\mathbf{y^`A_1y=y^`y}=\text{总平方和}=SST
  $$

* $$
  \mathbf{A_2}=\mathbf{11^`}/N
  \\\mathbf{y^`A_2y}=\mathbf{(y^`1)(1^`y)}/N=R(\mu)=\text{均数的约化平方和}
  $$

* $$
  \mathbf{A_{i+2}=Z_i (Z_i^`Z_i )^{-1}Z_i^`}
  \\
  \mathbf{y^`A_{i+2}y=}R(\mathbf{u_i})
  \\\text{其中：}\mathbf{A_i1=1}\text{; }\mathbf{A_i A_i =A_i}
  $$

  



## &#9353;方法二

### &#9312;适用范围：

* 某些混合模型：

$$
\mathbf{y=Xb+\sum{Z_i u_i}+e}
\\\text{模型中不允许考虑固定效应与随机效应的互作，或者随机效应嵌套在固定效应之下等}
$$

* 先用固定效应的最小二乘估计值对观察值进行校正，再将方法1用于校正后的观察值。
* 估计值无偏且平移不变。

### &#9313;基本方法

&#9332;为模型建立LS方程组
$$
W = \begin{bmatrix}\mathbf{X} & \mathbf{Z} \end{bmatrix}, \quad \beta^0 = \begin{pmatrix} \mathbf{b^0} \\ \mathbf{u^0} \end{pmatrix}
\\\beta^0 = (W^\prime W)^{-1} W^\prime y
$$
&#9333;用固定效应估计值$\mathbf{b^0}$校正$\mathbf{y}$，
$$
\mathbf{y^0 = y-Xb^0}
$$
&#9334;将方法1用于$\mathbf{y^0}$
$$
\hat\sigma^2_e=(\mathbf{y^`y-\beta^0W^`y})/(N-r(\mathbf{W}))
$$


# 四、MINQUE和MIVQUE

## &#9352;方法要点

* 估计值具有无偏性与平移不变性
* 要适用有关方差的先验信息
* 估计值具有最小范数，再者当方差的先验值等于真值且$\mathbf{y}$服从正态分布，估计值具有最小方差。

