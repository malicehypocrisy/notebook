# 一、育种值的概念

* 家畜的性状表型值（$\mathbf{P}$）中除了包括**一般育种值（$\mathbf{A}$）**以外，还包**括显型效应($\mathbf{D}$)**，**上位效应（$\mathbf{I}$）**以及**环境效应($\mathbf{E}$)**的影响。

$$
P = A + D + I + E 
$$

* 其中$ G = A + D + I  $为基因型值。

* 就整群而言：

$$
\sum G = \sum A 
$$

* **家畜的育种值又可称为累加基因型值或遗传值。** 

## &#9352;个体育种值

概念：使用形成个体基因型的双亲的配子的遗传贡献来表示，当遗传为加性时，
$$
a_i=g_s+g_d
$$

* $a_i$为个体育种值
* 
* 

# 二、最佳线性无偏预测（BLUP）

## &#9352;混合模型方程组

### &#9312;补充知识

联合密度$f(y,u)$描述y和u同时取值的概率分布。可以分解为:

* **条件密度$f(y|u)$:**描述在给定 $u$时 $y$的分布。
* **边缘密度 $f(u)$: **描述 $u$ 自身的分布，不依赖于其他变量。

$$
f(y,u)=f_{1}(y|u)_{2}f(u)
$$

**正态分布公式**：
$$
f(x) = \frac{1}{\sigma \sqrt{2\pi}} \exp\left( -\frac{(x - \mu)^2}{2\sigma^2} \right)
\\
f(\mathbf{x}) = \frac{1}{(2\pi)^{d/2} |\Sigma|^{1/2}} \exp\left( -\frac{1}{2} (\mathbf{x} - \boldsymbol{\mu})^\top \Sigma^{-1} (\mathbf{x} - \boldsymbol{\mu}) \right)\text{协方差矩阵}\sum
$$
### &#9313;公式推导

**通过对$f(\mathbf{y,u})$求关于$\beta$和$\mathbf{u}$的极大值推导出混合模型方程组**
$$
{E}(\mathbf{y} | \mathbf{u}) = \mathbf{X}\boldsymbol{\beta} + \mathbf{Z}\mathbf{u} + \mathbb{E}(\mathbf{e} | \mathbf{u})
\\= \mathbf{X}\boldsymbol{\beta} + \mathbf{Z}\mathbf{u}
\\\mathbf{y}∣\mathbf{u}∼MVN(\mathbf{X}\mathbf{β}+\mathbf{Zu},\mathbf{R})
$$
* 假设随机效应：$\mathbf{u}∼MVN(0,\mathbf{G})$

$$
Q=-\frac{1}{2}[(\mathbf{y-X\beta-Zu}^T)\mathbf{R}^{-1}(\mathbf{y-X\beta-Zu})+\mathbf{u^{T}G^{-1}u}]
$$
求偏导后：
$$
\begin{cases}
\mathbf{X}^\top \mathbf{R}^{-1} \mathbf{X} \boldsymbol{\hat{\beta}} + \mathbf{X}^\top \mathbf{R}^{-1} \mathbf{Z} \mathbf{\hat{u}} = \mathbf{X}^\top \mathbf{R}^{-1} \mathbf{y} \\
\mathbf{Z}^\top \mathbf{R}^{-1} \mathbf{X} \boldsymbol{\hat{\beta}} + \left( \mathbf{Z}^\top \mathbf{R}^{-1} \mathbf{Z} + \mathbf{G}^{-1} \right) \mathbf{\hat{u}} = \mathbf{Z}^\top \mathbf{R}^{-1} \mathbf{y}
\end{cases}
$$

### &#9314;**混合模型方程组（MME）**

$$
\begin{bmatrix}
\mathbf{X}^\top \mathbf{R}^{-1} \mathbf{X} & \mathbf{X}^\top \mathbf{R}^{-1} \mathbf{Z} \\
\mathbf{Z}^\top \mathbf{R}^{-1} \mathbf{X} & \mathbf{Z}^\top \mathbf{R}^{-1} \mathbf{Z} + \mathbf{G}^{-1}
\end{bmatrix}
\begin{bmatrix}
\boldsymbol{\hat{\beta}} \\
\mathbf{\hat{u}}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{X}^\top \mathbf{R}^{-1} \mathbf{y} \\
\mathbf{Z}^\top \mathbf{R}^{-1} \mathbf{y}
\end{bmatrix}\tag{1}
$$

* 设$\mathbf{Z}$为混合模型中的随机效应的结构矩阵。
* $\mathbf{G}$为随机效应的协方差矩阵。
* $\mathbf{R}$为残差效应的方差协方差矩阵。

$$
\mathbf{V}_y^{-1} = \mathbf{R}^{-1} - \mathbf{R}^{-1} \mathbf{Z} (\mathbf{Z}' \mathbf{R}^{-1} \mathbf{Z} + \mathbf{G}^{-1})^{-1} \mathbf{Z}' \mathbf{R}^{-1}
\\
\mathbf{V=R+ZGZ^`}
$$
### &#9315;建立亲缘关系矩阵

$$
\begin{bmatrix}
\mathbf{X}'\mathbf{X} & \mathbf{X}'\mathbf{Z} \\
\mathbf{Z}'\mathbf{X} & \mathbf{Z}'\mathbf{Z} + k \mathbf{A}^{-1}
\end{bmatrix}
\begin{bmatrix}
\hat{\beta} \\
\hat{u}
\end{bmatrix}
=
\begin{bmatrix}
\mathbf{X}'\mathbf{y} \\
\mathbf{Z}'\mathbf{y}
\end{bmatrix}
\\
$$

* 其中，$k = \sigma_e^2 / \sigma_u^2$。

$$
\text{Var}(\mathbf{e}) = \mathbf{R} = \mathbf{I} \sigma_e^2, \quad \text{Var}(\mathbf{u}) = \mathbf{G} = \mathbf{A} \sigma_u^2
$$

### &#9314;BLUP估计值的性质

&#9332;固定效应估计值的性质（具有GLS所有性质）
$$
\hat{\beta} =(\mathbf{X}^{\prime} \mathbf{V}^{-1} \mathbf{X })^{-}\mathbf{X}^{\prime} \mathbf{V}^{-1} \mathbf{y}
$$
&#9333;随机效应$\mathbf{u}$的BLUP估值为
$$
\mathbf{\hat{u}}=\mathbf{G}\mathbf{Z}^{T}\mathbf{V}^{-1}(\mathbf{y}-\mathbf{X}\hat{\beta})
$$
$E(\hat{u}) = 0$;